<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Flipper Zero Firmware: /Users/astrr/wtf/flipperzero-firmware/furi/core/kernel.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Flipper Zero Firmware
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_1b10a0714798903fe36325b43d76a276.html">furi</a></li><li class="navelem"><a class="el" href="dir_129cdca8bb1a0bec5ad41e77336da62e.html">core</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">kernel.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Furi Kernel primitives.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;core/base.h&gt;</code><br />
</div>
<p><a href="kernel_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab667af8a7d5e67e35756c1b32f657a98"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8h.html#ab667af8a7d5e67e35756c1b32f657a98">furi_kernel_is_irq_or_masked</a> ()</td></tr>
<tr class="memdesc:ab667af8a7d5e67e35756c1b32f657a98"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if CPU is in IRQ or kernel running and IRQ is masked.  <a href="kernel_8h.html#ab667af8a7d5e67e35756c1b32f657a98">More...</a><br /></td></tr>
<tr class="separator:ab667af8a7d5e67e35756c1b32f657a98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a073fde3bce86ed6ba81273b5bbecbe79"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8h.html#a073fde3bce86ed6ba81273b5bbecbe79">furi_kernel_lock</a> ()</td></tr>
<tr class="memdesc:a073fde3bce86ed6ba81273b5bbecbe79"><td class="mdescLeft">&#160;</td><td class="mdescRight">Lock kernel, pause process scheduling.  <a href="kernel_8h.html#a073fde3bce86ed6ba81273b5bbecbe79">More...</a><br /></td></tr>
<tr class="separator:a073fde3bce86ed6ba81273b5bbecbe79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72920174a85fbb5ae180755131fdbe95"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8h.html#a72920174a85fbb5ae180755131fdbe95">furi_kernel_unlock</a> ()</td></tr>
<tr class="memdesc:a72920174a85fbb5ae180755131fdbe95"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unlock kernel, resume process scheduling.  <a href="kernel_8h.html#a72920174a85fbb5ae180755131fdbe95">More...</a><br /></td></tr>
<tr class="separator:a72920174a85fbb5ae180755131fdbe95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af00d81f4871495e769f5c69b7d47cb65"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8h.html#af00d81f4871495e769f5c69b7d47cb65">furi_kernel_restore_lock</a> (int32_t lock)</td></tr>
<tr class="memdesc:af00d81f4871495e769f5c69b7d47cb65"><td class="mdescLeft">&#160;</td><td class="mdescRight">Restore kernel lock state.  <a href="kernel_8h.html#af00d81f4871495e769f5c69b7d47cb65">More...</a><br /></td></tr>
<tr class="separator:af00d81f4871495e769f5c69b7d47cb65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac469fe785bdf89ef018763341777f380"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8h.html#ac469fe785bdf89ef018763341777f380">furi_kernel_get_tick_frequency</a> ()</td></tr>
<tr class="memdesc:ac469fe785bdf89ef018763341777f380"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get kernel systick frequency.  <a href="kernel_8h.html#ac469fe785bdf89ef018763341777f380">More...</a><br /></td></tr>
<tr class="separator:ac469fe785bdf89ef018763341777f380"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e4d945d3ef6bc0317f473f37fe9b3ad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8h.html#a3e4d945d3ef6bc0317f473f37fe9b3ad">furi_delay_tick</a> (uint32_t ticks)</td></tr>
<tr class="memdesc:a3e4d945d3ef6bc0317f473f37fe9b3ad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delay execution.  <a href="kernel_8h.html#a3e4d945d3ef6bc0317f473f37fe9b3ad">More...</a><br /></td></tr>
<tr class="separator:a3e4d945d3ef6bc0317f473f37fe9b3ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06c00154c6901467eca95440341c090d"><td class="memItemLeft" align="right" valign="top">FuriStatus&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8h.html#a06c00154c6901467eca95440341c090d">furi_delay_until_tick</a> (uint32_t tick)</td></tr>
<tr class="memdesc:a06c00154c6901467eca95440341c090d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delay until tick.  <a href="kernel_8h.html#a06c00154c6901467eca95440341c090d">More...</a><br /></td></tr>
<tr class="separator:a06c00154c6901467eca95440341c090d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af05bd0818f17a1eb6819f21b25855be8"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8h.html#af05bd0818f17a1eb6819f21b25855be8">furi_get_tick</a> (void)</td></tr>
<tr class="memdesc:af05bd0818f17a1eb6819f21b25855be8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get current tick counter.  <a href="kernel_8h.html#af05bd0818f17a1eb6819f21b25855be8">More...</a><br /></td></tr>
<tr class="separator:af05bd0818f17a1eb6819f21b25855be8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a7b485f576bd52e57144592a8e01bee"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8h.html#a5a7b485f576bd52e57144592a8e01bee">furi_ms_to_ticks</a> (uint32_t milliseconds)</td></tr>
<tr class="memdesc:a5a7b485f576bd52e57144592a8e01bee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert milliseconds to ticks.  <a href="kernel_8h.html#a5a7b485f576bd52e57144592a8e01bee">More...</a><br /></td></tr>
<tr class="separator:a5a7b485f576bd52e57144592a8e01bee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a327d9dd71063803a3b1517dc4ec085b2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8h.html#a327d9dd71063803a3b1517dc4ec085b2">furi_delay_ms</a> (uint32_t milliseconds)</td></tr>
<tr class="memdesc:a327d9dd71063803a3b1517dc4ec085b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delay in milliseconds.  <a href="kernel_8h.html#a327d9dd71063803a3b1517dc4ec085b2">More...</a><br /></td></tr>
<tr class="separator:a327d9dd71063803a3b1517dc4ec085b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79926740bd423653299762d051dcc5cd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kernel_8h.html#a79926740bd423653299762d051dcc5cd">furi_delay_us</a> (uint32_t microseconds)</td></tr>
<tr class="memdesc:a79926740bd423653299762d051dcc5cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delay in microseconds.  <a href="kernel_8h.html#a79926740bd423653299762d051dcc5cd">More...</a><br /></td></tr>
<tr class="separator:a79926740bd423653299762d051dcc5cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Furi Kernel primitives. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a327d9dd71063803a3b1517dc4ec085b2" name="a327d9dd71063803a3b1517dc4ec085b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a327d9dd71063803a3b1517dc4ec085b2">&#9670;&nbsp;</a></span>furi_delay_ms()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void furi_delay_ms </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>milliseconds</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Delay in milliseconds. </p>
<p >This method uses kernel ticks on the inside, which causes delay to be aliased to scheduler timer intervals. Real wait time will be between X+ milliseconds. Special value: 0, will cause task yield. Also if used when kernel is not running will fall back to `furi_delay_us`.</p>
<dl class="section warning"><dt>Warning</dt><dd>Cannot be used from ISR</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">milliseconds</td><td>milliseconds to wait </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a3e4d945d3ef6bc0317f473f37fe9b3ad" name="a3e4d945d3ef6bc0317f473f37fe9b3ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e4d945d3ef6bc0317f473f37fe9b3ad">&#9670;&nbsp;</a></span>furi_delay_tick()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void furi_delay_tick </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ticks</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Delay execution. </p>
<dl class="section warning"><dt>Warning</dt><dd>This should never be called in interrupt request context.</dd></dl>
<p>Also keep in mind delay is aliased to scheduler timer intervals.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ticks</td><td>The ticks count to pause </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a06c00154c6901467eca95440341c090d" name="a06c00154c6901467eca95440341c090d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06c00154c6901467eca95440341c090d">&#9670;&nbsp;</a></span>furi_delay_until_tick()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FuriStatus furi_delay_until_tick </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>tick</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Delay until tick. </p>
<dl class="section warning"><dt>Warning</dt><dd>This should never be called in interrupt request context.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ticks</td><td>The tick until which kerel should delay task execution</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The furi status. </dd></dl>

</div>
</div>
<a id="a79926740bd423653299762d051dcc5cd" name="a79926740bd423653299762d051dcc5cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79926740bd423653299762d051dcc5cd">&#9670;&nbsp;</a></span>furi_delay_us()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void furi_delay_us </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>microseconds</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Delay in microseconds. </p>
<p >Implemented using Cortex DWT counter. Blocking and non aliased.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">microseconds</td><td>microseconds to wait </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af05bd0818f17a1eb6819f21b25855be8" name="af05bd0818f17a1eb6819f21b25855be8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af05bd0818f17a1eb6819f21b25855be8">&#9670;&nbsp;</a></span>furi_get_tick()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t furi_get_tick </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get current tick counter. </p>
<p >System uptime, may overflow.</p>
<dl class="section return"><dt>Returns</dt><dd>Current ticks in milliseconds </dd></dl>

</div>
</div>
<a id="ac469fe785bdf89ef018763341777f380" name="ac469fe785bdf89ef018763341777f380"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac469fe785bdf89ef018763341777f380">&#9670;&nbsp;</a></span>furi_kernel_get_tick_frequency()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t furi_kernel_get_tick_frequency </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get kernel systick frequency. </p>
<dl class="section return"><dt>Returns</dt><dd>systick counts per second </dd></dl>

</div>
</div>
<a id="ab667af8a7d5e67e35756c1b32f657a98" name="ab667af8a7d5e67e35756c1b32f657a98"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab667af8a7d5e67e35756c1b32f657a98">&#9670;&nbsp;</a></span>furi_kernel_is_irq_or_masked()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool furi_kernel_is_irq_or_masked </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if CPU is in IRQ or kernel running and IRQ is masked. </p>
<p >Originally this primitive was born as a workaround for FreeRTOS kernel primitives shenanigans with PRIMASK.</p>
<p >Meaningful use cases are:</p>
<ul>
<li>When kernel is started and you want to ensure that you are not in IRQ or IRQ is not masked(like in critical section)</li>
<li>When kernel is not started and you want to make sure that you are not in IRQ mode, ignoring PRIMASK.</li>
</ul>
<p >As you can see there will be edge case when kernel is not started and PRIMASK is not 0 that may cause some funky behavior. Most likely it will happen after kernel primitives being used, but control not yet passed to kernel. It's up to you to figure out if it is safe for your code or not.</p>
<dl class="section return"><dt>Returns</dt><dd>true if CPU is in IRQ or kernel running and IRQ is masked </dd></dl>

</div>
</div>
<a id="a073fde3bce86ed6ba81273b5bbecbe79" name="a073fde3bce86ed6ba81273b5bbecbe79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a073fde3bce86ed6ba81273b5bbecbe79">&#9670;&nbsp;</a></span>furi_kernel_lock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t furi_kernel_lock </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Lock kernel, pause process scheduling. </p>
<dl class="section warning"><dt>Warning</dt><dd>This should never be called in interrupt request context.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>previous lock state(0 - unlocked, 1 - locked) </dd></dl>

</div>
</div>
<a id="af00d81f4871495e769f5c69b7d47cb65" name="af00d81f4871495e769f5c69b7d47cb65"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af00d81f4871495e769f5c69b7d47cb65">&#9670;&nbsp;</a></span>furi_kernel_restore_lock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t furi_kernel_restore_lock </td>
          <td>(</td>
          <td class="paramtype">int32_t&#160;</td>
          <td class="paramname"><em>lock</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Restore kernel lock state. </p>
<dl class="section warning"><dt>Warning</dt><dd>This should never be called in interrupt request context.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">lock</td><td>The lock state</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>new lock state or error </dd></dl>

</div>
</div>
<a id="a72920174a85fbb5ae180755131fdbe95" name="a72920174a85fbb5ae180755131fdbe95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72920174a85fbb5ae180755131fdbe95">&#9670;&nbsp;</a></span>furi_kernel_unlock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t furi_kernel_unlock </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unlock kernel, resume process scheduling. </p>
<dl class="section warning"><dt>Warning</dt><dd>This should never be called in interrupt request context.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>previous lock state(0 - unlocked, 1 - locked) </dd></dl>

</div>
</div>
<a id="a5a7b485f576bd52e57144592a8e01bee" name="a5a7b485f576bd52e57144592a8e01bee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a7b485f576bd52e57144592a8e01bee">&#9670;&nbsp;</a></span>furi_ms_to_ticks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t furi_ms_to_ticks </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>milliseconds</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert milliseconds to ticks. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">milliseconds</td><td>time in milliseconds </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>time in ticks </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
